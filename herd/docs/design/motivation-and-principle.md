# 研发背景

为了解决传统 Web 开发模式带来的各种问题，我们进行了许多尝试，但由于前/后端的物理鸿沟，尝试的方案都大同小异。

同时，随着不同终端 (Pad/Mobile/PC) 的兴起，对开发人员的要求越来越高，纯浏览器端的响应式已经不能满足用户体验的高要求，我们往往需要针对不同的终端开发定制的版本。

为了提升开发效率，前后端分离的需求越来越被重视，后端负责业务/数据接口，前端负责展现/交互逻辑，同一份数据接口，我们可以定制开发多个版本。

今天我们重新思考了“前后端”的定义，并试图探索一种全新的前后端分离的开发模式。

# 需解决的问题

- 前后端的真正分离（技术、职责、运行）
- 前端复杂度提升
- 浏览器端服务器端渲染技术共通

# 功能与原理

## 功能项

herd 分为 herd 运行时和 shepherd 预处理器两部分。

herd 提供的功能主要是：

- 对后端接口的绑定/映射/代理
- 使用前端技术进行的服务端的渲染
- web 通用功能包装（session，i18n，security，csrf，权限等）
- 数据获取与组装逻辑
- 页面路由
- 浏览器端的同实现功能（i18n、模板渲染）
- 可选高级功能（图片上传，所见即所得的站点装修）

shepherd 提供的功能主要是：

- 任务调度
- 基于 Promise 的资源流处理
- 监视文件变化并触发
- 灵活的插件机制

## 如何解决问题

#### 大前端

前端并不只是运行在浏览器和 app 中的部分，它可以有一部分运行在服务器端。

#### 前后端的真正分离

在传统开发方式中，前后端在最终部署与运行时其实是一个工程，前端内容很难单独被运行与测试，并且实际参与前端内容产生的都是后端技术。

我们认为后端应该专注于业务逻辑，提供可靠的行为与数据接口，而不用过于关心数据与页面如何适配，更应该完全不用涉及到页面的产生。

而前端则专注于交互逻辑和展现，通过组织后端提供的可靠接口来完成业务。前后端之间的交互只有接口约定，它们是两个独立的工程并且可以不受互相影响的独立运行。

有一种尝试是使用纯前端渲染来进行分离尝试，但这会带来 SEO 和性能方面的问题。在 nodejs 出现之前这个问题可能就是无解的，而 nodejs 将前端技术带到了后端，给解决这个问题带来了可能。

---

herd 使用 nodejs 技术实现了一个 server ，支持与后端服务的绑定/映射/代理，现在支持 Dubbo 、http 协议。

Dubbo 是 Java 的技术，而 http 可以跨语言跨技术提供支持。本质上只要是二进制协议可被理解的技术，通过编写扩展即可让 herd 支持调用。

herd 支持调用并组装这些服务来渲染页面，支持将一个前端 http 请求直接映射或代理到后端服务上。由 herd 将前后端通讯的细节屏蔽在服务层面后，前后端从物理上被彻底分开。

由于后端只提供服务，通过 Spring-boot（Java）等技术可以非常轻量快速的启动并进行单元/集成测试，同时在启动和调试中不再需要前端的介入与协助。

前端不再只是一堆静态文件，同样可以使用 herd 快速启动并进行单元/集成测试，同时可通过 mock 后端接口的方式脱离后端进行全功能开发和调试。

#### 前端复杂度提升

前端复杂度提升主要在两方面。一方面是越来越复杂的功能和交互；另一方面是多终端支持。

前端社区为了越来越复杂的需求衍生了很多新技术，然而这些新技术大多不被浏览器原生支持，因此需要各种工具的帮助。同时为了组织日渐庞大的前端内容，结构化组件化的工程结构也是必然的。

shepherd 的目的就是提供一种简单可配置的方法将工具链串接起来，并将结构化的前端工程转化成可被浏览器识别的目标结构。

通过 shepherd 可以做到不限于下述内容的功能：预处理 Coffee、Typescript、ES6、React；预处理 SASS、LESS；预编译前端模板；拼接雪碧图；CMD 包装；browserify 引入；多文件过滤拼接，压缩等等。
